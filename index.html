<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>JavaScript analysis Intermediate Representation: JSIR</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>JSIR</h1>
        <p>JSIR is an intermediate representation for JavaScript analysis</p>
        <p class="view"><a href="https://github.com/too4words/jsir">View the Project on GitHub <small>too4words/jsir</small></a></p>
      </header>
      <section>
      <p>
        We see a need to stardarize an intermediate representation (IR) for those working on static
        analysis tools for JavaScript. Our hope that 
        different researchers will contribute translators to JSIR that run on different platforms 
        such as Java, .NET, and, finally, JavaScript itself. 
      </p>
      <p>
        Since it is in many cases desirable to do program analysis <em>enterily</em> in the browser, it should 
        also be possible to create JSIR by making REST calls to a server responsible for converting. One possibilty 
        for the <a href='http://esprima.org/doc/index.html#ast'>AST format</a> supported by 
        <a href='http://esprima.org/'>Esprima</a>.
      </p>
      <p>
        Below is an <a href='http://www.antlr.org/'>ANTLR v3</a> grammar for JSIR. 
      </p>
<pre><code>
/*
    - SSA-numbered bindings 
    - lexical scopes
    - fully dismantles control flow
    - support for CFGs with Entry and Exit BasicBlocks
    - the Blocks array in a ControlFlowGraph does NOT contain Entry and Exit BasicBlocks
*/
/* @namespace {Microsoft.CodeAnalysis.JSIRGrammar} */

grammar JSIR;
prog : Program;

Mode : 'strict' | 'non';
Boolean : 'true' | 'false';
Eval : 'eval';
Null : 'null';
This : 'this';
Undefined : 'undefined';
Number : NUMBER+;

Value :             
    Number
  | ConstantString
  | Boolean
  | Eval
  | Null
  | This
  | Undefined
  | Binding
  | FunctionReference   
;

Program : GlobalScope /* @name {functionDeclarations}*/FunctionDeclaration* ControlFlowGraph;

Statement :
      Assignment
    | Call  
    | DebuggerStatement
    | ReturnStatement
    ;

Call : StaticMethodCall | MethodCall | ConstructorCall ;

Assignment : 
      SimpleAssignment 
    | FieldAssignement 
    | ArrayAssignment     
           ;

SimpleAssignment     :   
    /* @name {LHS}*/Binding 
    '=' 
    /* @name {RHS}*/Expression;
FieldAssignement    :   
    /* @name {LHS}*/Binding 
    '.' /* @name {field}*/Binding 
    '=' 
    /* @name {RHS}*/Binding;
ArrayAssignment     :   
    /* @name {LHS}*/Binding 
    '[' 
    /* @name {index}*/ Binding 
    ']' 
    '=' 
    /* @name {RHS}*/Binding;

StaticMethodCall      : 
    /* @name {LHS}*/Binding
    '=' 
    /* @name {target}*/Binding
    '(' /* @name {arguments}*/Binding (',' /* @name {arguments}*/Binding)*')' 
    ';';

MethodCall :   
    /* @name {LHS}*/Binding 
    '=' 
    /* @name {target}*/Binding 
    '.' 
    /* @name {field}*/STRING
    '(' 
        /* @name {parameter}*/Binding ? (',' /* @name {parameter}*/Binding)* 
    ')';
ConstructorCall     :   
    /* @name {LHS}*/Binding 
    '=' 
    'new' 
    /* @name {function}*/Binding 
    '(' /* @name {parameter}*/Binding ? (',' /* @name {parameter}*/Binding)* ')'
    ;

Binding : Type /* @name {variable}*/ID '_' Version;// Scope;

// This is an uninterpreted type 
Type    : STRING;

/* This is intended to represent the SSA version */
Version : NUMBER+;

Scope : GlobalScope | LocalScope;
GlobalScope : 
    /* @name {bindings}*/Binding (/* @name {bindings}*/Binding)*
    ;
LocalScope : 
    'var' 
    '{' /* @name {parent}*/Scope '}'
    /* @name {bindings}*/Binding (/* @name {bindings}*/Binding)*
    ';';

Expression :
    FunctionDeclaration
  | ObjectLiteral
  | ArrayLiteral
  | ArrayReference
  | FieldReference
  | BinaryOperation
  | UnaryOperation
  | PhiFunction 
  | IotaFunction 
  | DeleteOperation  
  | Value
    ;

FunctionDeclaration:
'function' /* @name {name}*/ID 
    '(' /* @name {arguments}*/Binding (',' /* @name {arguments}*/Binding)* ')' 
    '{' 
    Mode 
    // entry and exit blocks are not included in the list blocks above
    /* @name {declarations}*/LocalScope 
    /* @name {nestedFunctions}*/FunctionDeclaration*
    ControlFlowGraph
    '}'
    ;
ControlFlowGraph :
    /* @name {entryBlock}*/BasicBlock 
    /* @name {blocks}*/BasicBlock* 
    /* @name {exitBlock}*/BasicBlock       
    ;

KeyValuePair : /* @name {field}*/STRING ':' /* @name {value}*/Value;
ObjectLiteral:
'{' /* @name {pair}*/KeyValuePair (',' /* @name {pair}*/KeyValuePair)* '}';

ArrayLiteral :
'[' /* @name {elements}*/Binding (',' /* @name {elements}*/Binding)* ']';
ArrayReference:
/* @name {target}*/Binding '[' /* @name {index}*/Binding ']';
FieldReference:
/* @name {target}*/Binding '.' /* @name {field}*/STRING;
DeleteOperation: 
      DeleteBinding 
    | DeleteArrayReference 
    | DeleteValue ;

DeleteBinding: 
    'delete' 
    /* @name {target}*/Binding 
    '.' 
    /* @name {field}*/Binding;
DeleteArrayReference: 
    'delete' 
    /* @name {target}*/Binding 
    '[' 
    /* @name {index}*/Binding 
    ']';
DeleteValue : 
    'delete' Binding;

BinaryOperation : 
    /* @name {LHS}*/Binding 
    BinaryOperator 
    /* @name {RHS}*/Binding;
UnaryOperation : 
    UnaryOperator Binding;

PhiFunction :
    'phi' 
    '('
    /* @name {bindings}*/Binding
    (',' /* @name {bindings}*/Binding)*
    ')'
    ;
IotaFunction : 
    'iota'             
    '('
    /* @name {variable}*/ID
    ')'
    ;

FunctionReference : 
    'ref'             
    '('
    /* @name {variable}*/ID
    ')'
    ;

DebuggerStatement : 'debugger';
ReturnStatement : 'return' /* @name {value} */Binding;

ConstantString : STRING;
Label: STRING;

Jump :
    SimpleGoto
  | ConditionalGoto
  | ThrowTo;

SimpleGoto : 'goto' /* @name {labels}*/Label (',' /* @name {labels}*/Label)*;
ConditionalGoto : 
    'goto' 
    /* @name {predicate}*/Binding 
    /* @name {label1}*/Label 
    /* @name {label2}*/Label;
ThrowTo : 
    'throwto' Binding;

BasicBlock :
    RegularBasicBlock |
    ExceptionalBasicBlock;

//  EmptyBasicBlock |
//EmptyBasicBlock : Label Jump;

RegularBasicBlock : Label Statement* Jump;

ExceptionalBasicBlock : 'set-catch-label' Label Binding Statement* Jump;

UnaryOperator    : '!'| '-' | '+' | '~'| 'typeof' | 'void' | '++'| '--';
BinaryOperator   : '+'|'-'|'^'|'|'|'*'|'/'|'%'| 
                   '&&' | '||' | 
                   '|' | '&' | '>>' | '<<'| '>>>' | 
                   '^' | 'instanceof' |
                   '==' | '===' | '!=' | '!=='
                 ;

///////////////////////////////

STRING
    :   '"' StringCharacters? '"' |
        '\'' StringCharacters? '\'' ;
StringCharacters
    :   ('a'..'z')|('A'..'Z')|('0'..'9') ;

fragment NUMBER : '0'..'9';
fragment ID : ('a'..'z' | 'A'..'Z' | '_' | '-' | 'a'..'z' | 'A'..'Z' | '$' | NUMBER)+;

//WS : ('\r'|'\n'|'\t') -> skip ;
//COMMENT : (
//	('#'| '//') ~[\r\n]* '\r'? '\n'
//		| '/*[' .*? ']*/
//	)  -> skip ;
</code></pre>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/too4words">too4words</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
